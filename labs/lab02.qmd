---
title: "Lab 1 – Είδη Μεταβλητών & Σωστή Αναπαράσταση (R)"
format:
  html:
    toc: true
    code-fold: true
    code-tools: true
execute:
  warning: false
  message: false
---

## Στόχοι
Με το τέλος του εργαστηρίου θα μπορείς να:

- αναγνωρίζεις το **είδος** μιας μεταβλητής (ποιοτική/ποσοτική, binary/nominal/ordinal, discrete/continuous)
- επιλέγεις τη **σωστή οπτικοποίηση** (barplot, histogram, boxplot) για κάθε είδος μεταβλητής
- καταλαβαίνεις *γιατί* η λάθος αναπαράσταση οδηγεί σε λάθος συμπεράσματα

---

## Προετοιμασία: πακέτα


### Τι κάνει αυτό το κομμάτι κώδικα;

- Ελέγχει αν τα απαραίτητα πακέτα υπάρχουν στον υπολογιστή σας  
- Εγκαθιστά **μόνο όσα λείπουν** (δεν τα ξανακατεβάζει κάθε φορά)
- Φορτώνει τα πακέτα χωρίς ενοχλητικά μηνύματα
- Θέτει seed για αναπαραγωγιμότητα αποτελεσμάτων (δηλαδή κάθε φορά που θα τρέχεται τον κω΄δικα θα "γεννά" τα ίδια δεδομένα 

**Δεν χρειάζεται να τροποποιήσετε αυτόν τον κώδικα.**  Απλώς βεβαιωθείτε ότι εκτελείται χωρίς σφάλματα.

```{r setup, include=FALSE}
options(timeout = 600)

pkgs <- c("dplyr", "ggplot2", "tidyr", "tibble")
to_install <- setdiff(pkgs, rownames(installed.packages()))
if (length(to_install) > 0) {
  install.packages(to_install, repos = "https://cloud.r-project.org")
}

suppressPackageStartupMessages(
  invisible(lapply(pkgs, library, character.only = TRUE))
)

set.seed(123)
```

## 1. Γρήγορη υπενθύμιση: τι είναι «είδος μεταβλητής»;

Το είδος μιας μεταβλητής καθορίζει:
- πώς την περιγράφουμε,
- πώς την απεικονίζουμε,
- και ποια στατιστικά μέτρα ή αναλύσεις επιτρέπονται.

---

### 1.1 Ποιοτικές μεταβλητές (Categorical variables)

Οι ποιοτικές μεταβλητές περιγράφουν **κατηγορίες** και όχι αριθμητικά μεγέθη.

#### 1.1.1 Διχοτομικές (Binary / Dichotomous)
- Έχουν **ακριβώς δύο** κατηγορίες  
- Παραδείγματα:
  - Ναι / Όχι
  - Άνδρας / Γυναίκα
  - Ασθενής / Μη ασθενής

**Συνήθης αναπαράσταση:** πίνακας συχνοτήτων, bar plot

---

#### 1.1.2 Ονομαστικές (Nominal)
- Έχουν **περισσότερες από δύο** κατηγορίες
- **Δεν υπάρχει φυσική σειρά** μεταξύ τους  
- Παραδείγματα:
  - Ομάδα αίματος (A, B, AB, O)
  - Τόπος κατοικίας
  - Τύπος θεραπείας

**Συνήθης αναπαράσταση:** πίνακας συχνοτήτων, bar plot

---

#### 1.1.3 Διατεταγμένες (Ordinal)
- Έχουν κατηγορίες με **ουσιαστική σειρά**
- Οι αποστάσεις μεταξύ κατηγοριών **δεν είναι αριθμητικά ορισμένες**
- Παραδείγματα:
  - Ήπιος / Μέτριος / Σοβαρός πόνος
  - Στάδιο νόσου I – II – III – IV
  - Κλίμακες Likert (π.χ. 1–5)

**Συνήθης αναπαράσταση:** πίνακας συχνοτήτων, bar plot με σωστή σειρά

---

### 1.2 Ποσοτικές μεταβλητές (Numeric variables)

Οι ποσοτικές μεταβλητές παίρνουν **αριθμητικές τιμές** και επιτρέπουν αριθμητικούς υπολογισμούς.

#### 1.2.1 Διακριτές (Discrete)
- Παίρνουν **ακέραιες τιμές**
- Προκύπτουν από **μέτρηση πλήθους**
- Παραδείγματα:
  - Αριθμός επισκέψεων στο νοσοκομείο
  - Αριθμός επεισοδίων
  - Αριθμός παιδιών

**Συνήθης αναπαράσταση:** histogram (με ακέραια bins), bar plot

---

#### 1.2.2 Συνεχείς (Continuous)
- Παίρνουν τιμές σε **συνεχή κλίμακα**
- Θεωρητικά μπορούν να πάρουν άπειρες τιμές σε ένα διάστημα
- Παραδείγματα:
  - Ηλικία
  - Ύψος
  - Αρτηριακή πίεση
  - Βάρος

**Συνήθης αναπαράσταση:** histogram, density plot, boxplot

---

::: {.callout-note}
🔑 **Κανόνας εργαστηρίου:**  
Πριν κάνεις οποιονδήποτε υπολογισμό ή γράφημα, **αναγνώρισε πρώτα το είδος της μεταβλητής**.
:::

---

## 2. Θα φτιάξουμε δικά μας δεδομένα  
*(ένα μικρό «κλινικό» dataset για εξάσκηση)*

Σε αυτό το εργαστήριο **δεν χρησιμοποιούμε πραγματικά δεδομένα ασθενών**.  
Αντίθετα, δημιουργούμε ένα **τεχνητό (simulated) dataset** που μοιάζει με κλινικό,
ώστε να μπορούμε:

- να ελέγξουμε **όλα τα είδη μεταβλητών**,
- να ξέρουμε *ακριβώς* τι αντιπροσωπεύει κάθε στήλη,
- να επικεντρωθούμε στη **σωστή αναπαράσταση** και όχι στα ίδια τα δεδομένα.

👉 **Κάθε γραμμή του dataset αντιστοιχεί σε ένα άτομο (ασθενή).**

---

### Τι μεταβλητές θα περιέχει το dataset

Το dataset θα περιλαμβάνει:

- **Ποιοτικές μεταβλητές**
  - `sex`: διχοτομική (binary)
  - `blood_group`: ονομαστική (nominal)
  - `pain`: διατεταγμένη (ordinal)
- **Ποσοτικές μεταβλητές**
  - `hospital_visits`: διακριτή (discrete count)
  - `age`: συνεχής (continuous)
  - `systolic_bp`: συνεχής (continuous)

---

::: {.callout-note collapse="true"}
### Κώδικας δημιουργίας του dataset

- Δημιουργεί 120 άτομα
- Ορίζει σωστά τους τύπους των μεταβλητών (`factor`, `ordered`, numeric)
- Κρατά ρεαλιστικές τιμές (π.χ. ηλικία ≥ 18)

```{r}
n <- 120

df <- tibble::tibble(
  id = 1:n,
  
  # Ποιοτική - διχοτομική (binary)
  sex = factor(
    sample(c("Female", "Male"), n, replace = TRUE),
    levels = c("Female", "Male")
  ),
  
  # Ποιοτική - ονομαστική (nominal)
  blood_group = factor(
    sample(c("A", "B", "AB", "O"), n, replace = TRUE),
    levels = c("A", "B", "AB", "O")
  ),
  
  # Ποιοτική - διατεταγμένη (ordinal)
  pain = factor(
    sample(
      c("Mild", "Moderate", "Severe"),
      n,
      replace = TRUE,
      prob = c(0.45, 0.35, 0.20)
    ),
    levels = c("Mild", "Moderate", "Severe"),
    ordered = TRUE
  ),
  
  # Ποσοτική - διακριτή (counts)
  hospital_visits = rpois(n, lambda = 2),
  
  # Ποσοτικές - συνεχείς
  age = round(rnorm(n, mean = 42, sd = 14), 1),
  systolic_bp = round(rnorm(n, mean = 125, sd = 15), 0)
) |>
  dplyr::mutate(
    age = pmax(age, 18),                  # ελάχιστη ηλικία 18
    systolic_bp = pmax(systolic_bp, 80)   # ρεαλιστικά όρια πίεσης
  )

dplyr::glimpse(df)
```
::: {.callout-note collapse="true"}

---

3. Ποιοτικές μεταβλητές: σωστή περιγραφή & σωστή αναπαράσταση

3.1 Διχοτομική (binary): sex

Σωστή περιγραφή: συχνότητες και ποσοστά
Σωστή οπτικοποίηση: bar plot (ή pie, αλλά bar είναι προτιμότερο)

```{r}
tab_sex <- df |>
  dplyr::count(sex) |>
  dplyr::mutate(percent = 100 * n / sum(n))

tab_sex

ggplot(df, aes(x = sex)) +
  geom_bar() +
  labs(title = "Φύλο (binary)", x = "Sex", y = "Count")
```

⸻

3.2 Ονομαστική (nominal): blood_group

Σωστή περιγραφή: συχνότητες/ποσοστά
Σωστή οπτικοποίηση: bar plot

tab_bg <- df |>
  dplyr::count(blood_group) |>
  dplyr::mutate(percent = 100 * n / sum(n)) |>
  dplyr::arrange(desc(n))

tab_bg

ggplot(df, aes(x = blood_group)) +
  geom_bar() +
  labs(title = "Ομάδα αίματος (nominal)", x = "Blood group", y = "Count")


⸻

3.3 Διατεταγμένη (ordinal): pain

Σωστή περιγραφή: συχνότητες/ποσοστά (και διατήρηση σειράς)
Σωστή οπτικοποίηση: bar plot (με σωστή σειρά)

tab_pain <- df |>
  dplyr::count(pain) |>
  dplyr::mutate(percent = 100 * n / sum(n))

tab_pain

ggplot(df, aes(x = pain)) +
  geom_bar() +
  labs(title = "Ένταση πόνου (ordinal)", x = "Pain severity", y = "Count")

::: {.callout-warning}
Συχνό λάθος: να αποθηκεύσεις ordinal ως character ή factor χωρίς ordered=TRUE.
Τότε χάνεται η έννοια της σειράς.
:::

⸻

4. Ποσοτικές μεταβλητές: σωστή περιγραφή & σωστή αναπαράσταση

4.1 Διακριτή (discrete): hospital_visits

Σωστή περιγραφή: median/IQR (συχνά), ή mean/SD αν είναι περίπου συμμετρική
Σωστή οπτικοποίηση: histogram / bar-like histogram (counts)

summary(df$hospital_visits)

ggplot(df, aes(x = hospital_visits)) +
  geom_histogram(bins = max(df$hospital_visits) - min(df$hospital_visits) + 1) +
  labs(title = "Επισκέψεις στο νοσοκομείο (discrete count)", x = "Number of visits", y = "Count")


⸻

4.2 Συνεχής (continuous): age

Σωστή περιγραφή:
	•	αν συμμετρική: mean ± SD
	•	αν ασύμμετρη: median (IQR)

Σωστή οπτικοποίηση: histogram, density, boxplot

mean(df$age); sd(df$age)
quantile(df$age, probs = c(0.25, 0.5, 0.75))

ggplot(df, aes(x = age)) +
  geom_histogram(bins = 25) +
  labs(title = "Ηλικία (continuous)", x = "Age (years)", y = "Count")

ggplot(df, aes(y = age)) +
  geom_boxplot() +
  labs(title = "Boxplot ηλικίας (continuous)", y = "Age (years)")


⸻

4.3 Συνεχής (continuous): systolic_bp

mean(df$systolic_bp); sd(df$systolic_bp)
quantile(df$systolic_bp, probs = c(0.25, 0.5, 0.75))

ggplot(df, aes(x = systolic_bp)) +
  geom_histogram(bins = 25) +
  labs(title = "Συστολική πίεση (continuous)", x = "Systolic BP (mmHg)", y = "Count")


⸻

5. “Ποια αναπαράσταση πάει με ποια μεταβλητή;” (πίνακας-κανόνας)

Είδος μεταβλητής	Περιγραφή	Συνηθισμένα γραφήματα
Binary (categorical)	n (%)	bar plot
Nominal (categorical)	n (%)	bar plot
Ordinal (categorical)	n (%) (με σειρά)	bar plot (με σειρά)
Discrete (numeric)	median (IQR) ή mean (SD)	histogram
Continuous (numeric)	mean (SD) ή median (IQR)	histogram, boxplot


⸻

6. Ασκήσεις

Άσκηση 1 — Ταξινόμησε τις μεταβλητές

Για καθεμία από τις μεταβλητές του df, γράψε:
	•	ποιοτική/ποσοτική
	•	υποτύπο (binary/nominal/ordinal ή discrete/continuous)
	•	1 “σωστή” περιγραφή + 1 “σωστό” plot

::: {.callout-tip collapse=“true”}
Hint: Οι sex, blood_group, pain είναι ποιοτικές. Οι hospital_visits, age, systolic_bp είναι ποσοτικές.
:::

⸻

Άσκηση 2 — Φτιάξε μια νέα ordinal μεταβλητή

Δημιούργησε μια μεταβλητή risk_group με 3 επίπεδα: Low/Medium/High, ordered, με βάση τη συστολική πίεση:
	•	Low: < 120
	•	Medium: 120–139
	•	High: ≥ 140

Μετά κάνε:
	•	πίνακα συχνοτήτων
	•	bar plot (με σωστή σειρά)

df2 <- df |>
  dplyr::mutate(
    risk_group = dplyr::case_when(
      systolic_bp < 120 ~ "Low",
      systolic_bp < 140 ~ "Medium",
      TRUE ~ "High"
    ),
    risk_group = factor(risk_group, levels = c("Low", "Medium", "High"), ordered = TRUE)
  )

df2 |>
  dplyr::count(risk_group) |>
  dplyr::mutate(percent = 100 * n / sum(n))

ggplot(df2, aes(x = risk_group)) +
  geom_bar() +
  labs(title = "Risk group (ordinal)", x = "Risk group", y = "Count")


⸻

Άσκηση 3 — Τι πάει λάθος αν κάνω “λάθος τύπο”;

Δοκίμασε να μετατρέψεις τη pain σε character και δες τι αλλάζει.

df_bad <- df |>
  dplyr::mutate(pain_bad = as.character(pain))

class(df$pain)
class(df_bad$pain_bad)

::: {.callout-note}
Γράψε 2 προτάσεις: τι χάσαμε όταν έγινε character; γιατί αυτό είναι πρόβλημα;
:::

⸻

7. Τι κρατάμε (take-home)
	1.	Πρώτο βήμα σε κάθε ανάλυση: αναγνώριση τύπου μεταβλητής.
	2.	Η σωστή περιγραφή/οπτικοποίηση εξαρτάται από το είδος της μεταβλητής.
	3.	Αν αποθηκεύσεις ordinal χωρίς σειρά, χάνεις πληροφορία.

