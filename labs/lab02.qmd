---
title: "Lab 1 – Είδη Μεταβλητών & Σωστή Αναπαράσταση (R)"
subtitle: "Βιοστατιστική"
format:
  html:
    toc: true
    code-fold: true
    code-tools: true
execute:
  warning: false
  message: false
---

# Lab 1 – Είδη Μεταβλητών & Σωστή Αναπαράσταση (R)

## Στόχοι
Με το τέλος του εργαστηρίου θα μπορείς να:

- αναγνωρίζεις το **είδος** μιας μεταβλητής (ποιοτική/ποσοτική, binary/nominal/ordinal, discrete/continuous)
- επιλέγεις **σωστή περιγραφή** (πίνακες, μέτρα θέσης/διασποράς) και **σωστή οπτικοποίηση** (barplot, histogram, boxplot)
- καταλαβαίνεις *γιατί* η λάθος αναπαράσταση οδηγεί σε λάθος συμπεράσματα

---

## 0. Προετοιμασία: πακέτα

```{r setup, include=FALSE}
options(timeout = 600)

pkgs <- c("dplyr", "ggplot2", "tidyr", "tibble")
to_install <- setdiff(pkgs, rownames(installed.packages()))
if (length(to_install) > 0) install.packages(to_install, repos = "https://cloud.r-project.org")

suppressPackageStartupMessages(invisible(lapply(pkgs, library, character.only = TRUE)))
set.seed(123)


⸻

1. Γρήγορη υπενθύμιση: τι είναι “είδος μεταβλητής”;
	•	Ποιοτικές (categorical): περιγράφουν κατηγορίες
	•	Διχοτομικές (binary): 2 κατηγορίες
	•	Ονομαστικές (nominal): >2 κατηγορίες, χωρίς σειρά
	•	Διατεταγμένες (ordinal): κατηγορίες με σειρά
	•	Ποσοτικές (numeric): αριθμητικές τιμές
	•	Διακριτές (discrete): ακέραιες μετρήσεις (counts)
	•	Συνεχείς (continuous): μετρήσεις σε συνεχή κλίμακα (height, BP)

⸻

2. Θα φτιάξουμε δικά μας δεδομένα (ένα μικρό “κλινικό” dataset)

Κάθε γραμμή = ένα άτομο.

n <- 120

df <- tibble::tibble(
  id = 1:n,
  # Qualitative - binary
  sex = factor(sample(c("Female", "Male"), n, replace = TRUE), levels = c("Female", "Male")),
  
  # Qualitative - nominal (>2, no order)
  blood_group = factor(sample(c("A", "B", "AB", "O"), n, replace = TRUE),
                       levels = c("A", "B", "AB", "O")),
  
  # Qualitative - ordinal (ordered categories)
  pain = factor(sample(c("Mild", "Moderate", "Severe"), n, replace = TRUE, prob = c(0.45, 0.35, 0.20)),
                levels = c("Mild", "Moderate", "Severe"),
                ordered = TRUE),
  
  # Quantitative - discrete (counts)
  hospital_visits = rpois(n, lambda = 2),
  
  # Quantitative - continuous (measurements)
  age = round(rnorm(n, mean = 42, sd = 14), 1),
  systolic_bp = round(rnorm(n, mean = 125, sd = 15), 0)
) |>
  dplyr::mutate(
    age = pmax(age, 18),                 # minimum age 18
    systolic_bp = pmax(systolic_bp, 80)  # keep plausible values
  )

dplyr::glimpse(df)


⸻

3. Ποιοτικές μεταβλητές: σωστή περιγραφή & σωστή αναπαράσταση

3.1 Διχοτομική (binary): sex

Σωστή περιγραφή: συχνότητες και ποσοστά
Σωστή οπτικοποίηση: bar plot (ή pie, αλλά bar είναι προτιμότερο)

tab_sex <- df |>
  dplyr::count(sex) |>
  dplyr::mutate(percent = 100 * n / sum(n))

tab_sex

ggplot(df, aes(x = sex)) +
  geom_bar() +
  labs(title = "Φύλο (binary)", x = "Sex", y = "Count")


⸻

3.2 Ονομαστική (nominal): blood_group

Σωστή περιγραφή: συχνότητες/ποσοστά
Σωστή οπτικοποίηση: bar plot

tab_bg <- df |>
  dplyr::count(blood_group) |>
  dplyr::mutate(percent = 100 * n / sum(n)) |>
  dplyr::arrange(desc(n))

tab_bg

ggplot(df, aes(x = blood_group)) +
  geom_bar() +
  labs(title = "Ομάδα αίματος (nominal)", x = "Blood group", y = "Count")


⸻

3.3 Διατεταγμένη (ordinal): pain

Σωστή περιγραφή: συχνότητες/ποσοστά (και διατήρηση σειράς)
Σωστή οπτικοποίηση: bar plot (με σωστή σειρά)

tab_pain <- df |>
  dplyr::count(pain) |>
  dplyr::mutate(percent = 100 * n / sum(n))

tab_pain

ggplot(df, aes(x = pain)) +
  geom_bar() +
  labs(title = "Ένταση πόνου (ordinal)", x = "Pain severity", y = "Count")

::: {.callout-warning}
Συχνό λάθος: να αποθηκεύσεις ordinal ως character ή factor χωρίς ordered=TRUE.
Τότε χάνεται η έννοια της σειράς.
:::

⸻

4. Ποσοτικές μεταβλητές: σωστή περιγραφή & σωστή αναπαράσταση

4.1 Διακριτή (discrete): hospital_visits

Σωστή περιγραφή: median/IQR (συχνά), ή mean/SD αν είναι περίπου συμμετρική
Σωστή οπτικοποίηση: histogram / bar-like histogram (counts)

summary(df$hospital_visits)

ggplot(df, aes(x = hospital_visits)) +
  geom_histogram(bins = max(df$hospital_visits) - min(df$hospital_visits) + 1) +
  labs(title = "Επισκέψεις στο νοσοκομείο (discrete count)", x = "Number of visits", y = "Count")


⸻

4.2 Συνεχής (continuous): age

Σωστή περιγραφή:
	•	αν συμμετρική: mean ± SD
	•	αν ασύμμετρη: median (IQR)

Σωστή οπτικοποίηση: histogram, density, boxplot

mean(df$age); sd(df$age)
quantile(df$age, probs = c(0.25, 0.5, 0.75))

ggplot(df, aes(x = age)) +
  geom_histogram(bins = 25) +
  labs(title = "Ηλικία (continuous)", x = "Age (years)", y = "Count")

ggplot(df, aes(y = age)) +
  geom_boxplot() +
  labs(title = "Boxplot ηλικίας (continuous)", y = "Age (years)")


⸻

4.3 Συνεχής (continuous): systolic_bp

mean(df$systolic_bp); sd(df$systolic_bp)
quantile(df$systolic_bp, probs = c(0.25, 0.5, 0.75))

ggplot(df, aes(x = systolic_bp)) +
  geom_histogram(bins = 25) +
  labs(title = "Συστολική πίεση (continuous)", x = "Systolic BP (mmHg)", y = "Count")


⸻

5. “Ποια αναπαράσταση πάει με ποια μεταβλητή;” (πίνακας-κανόνας)

Είδος μεταβλητής	Περιγραφή	Συνηθισμένα γραφήματα
Binary (categorical)	n (%)	bar plot
Nominal (categorical)	n (%)	bar plot
Ordinal (categorical)	n (%) (με σειρά)	bar plot (με σειρά)
Discrete (numeric)	median (IQR) ή mean (SD)	histogram
Continuous (numeric)	mean (SD) ή median (IQR)	histogram, boxplot


⸻

6. Ασκήσεις

Άσκηση 1 — Ταξινόμησε τις μεταβλητές

Για καθεμία από τις μεταβλητές του df, γράψε:
	•	ποιοτική/ποσοτική
	•	υποτύπο (binary/nominal/ordinal ή discrete/continuous)
	•	1 “σωστή” περιγραφή + 1 “σωστό” plot

::: {.callout-tip collapse=“true”}
Hint: Οι sex, blood_group, pain είναι ποιοτικές. Οι hospital_visits, age, systolic_bp είναι ποσοτικές.
:::

⸻

Άσκηση 2 — Φτιάξε μια νέα ordinal μεταβλητή

Δημιούργησε μια μεταβλητή risk_group με 3 επίπεδα: Low/Medium/High, ordered, με βάση τη συστολική πίεση:
	•	Low: < 120
	•	Medium: 120–139
	•	High: ≥ 140

Μετά κάνε:
	•	πίνακα συχνοτήτων
	•	bar plot (με σωστή σειρά)

df2 <- df |>
  dplyr::mutate(
    risk_group = dplyr::case_when(
      systolic_bp < 120 ~ "Low",
      systolic_bp < 140 ~ "Medium",
      TRUE ~ "High"
    ),
    risk_group = factor(risk_group, levels = c("Low", "Medium", "High"), ordered = TRUE)
  )

df2 |>
  dplyr::count(risk_group) |>
  dplyr::mutate(percent = 100 * n / sum(n))

ggplot(df2, aes(x = risk_group)) +
  geom_bar() +
  labs(title = "Risk group (ordinal)", x = "Risk group", y = "Count")


⸻

Άσκηση 3 — Τι πάει λάθος αν κάνω “λάθος τύπο”;

Δοκίμασε να μετατρέψεις τη pain σε character και δες τι αλλάζει.

df_bad <- df |>
  dplyr::mutate(pain_bad = as.character(pain))

class(df$pain)
class(df_bad$pain_bad)

::: {.callout-note}
Γράψε 2 προτάσεις: τι χάσαμε όταν έγινε character; γιατί αυτό είναι πρόβλημα;
:::

⸻

7. Τι κρατάμε (take-home)
	1.	Πρώτο βήμα σε κάθε ανάλυση: αναγνώριση τύπου μεταβλητής.
	2.	Η σωστή περιγραφή/οπτικοποίηση εξαρτάται από το είδος της μεταβλητής.
	3.	Αν αποθηκεύσεις ordinal χωρίς σειρά, χάνεις πληροφορία.

